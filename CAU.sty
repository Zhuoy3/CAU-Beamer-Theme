\mode<presentation>

\newif\ifbeamer@secheader
\beamer@secheaderfalse

% \DeclareOptionBeamer{secheader}{\beamer@secheadertrue}
\ProcessOptionsBeamer

\useoutertheme[footline=authorinstitutetitle,subsection=false]{smoothbars}
\makeatletter % [add curpage/total page at the bottom](http://tex.stackexchange.com/questions/100838/beamer-dresden-theme-miniframes-appeareance-and-frame-number-insertion)
\newcommand{\frameofframes}{/}
\newcommand{\setframeofframes}[1]{\renewcommand{\frameofframes}{#1}}
\setbeamertemplate{footline}
{
    % \begin{beamercolorbox}[colsep=1.5pt]
    %     {upper separation line foot}
    % \end{beamercolorbox}
    % \begin{beamercolorbox}[ht=2.5ex,dp=1.125ex,leftskip=.3cm,rightskip=.3cm plus1fil]
    %     {author in head/foot}
    %     \leavevmode
    %     {\usebeamerfont{author in head/foot}\insertshortauthor}
    %     \hfill
    %     {\usebeamerfont{institute in head/foot}\usebeamercolor[fg]{institute in head/foot}\insertshortinstitute}
    % \end{beamercolorbox}
    \begin{beamercolorbox}[ht=2.5ex,dp=1.125ex,leftskip=.3cm,rightskip=.3cm plus1fil]
        {title in head/foot}
        {\usebeamerfont{title in head/foot}\insertshorttitle}%
        \hfill
        {\usebeamerfont{frame number}\usebeamercolor[fg]{frame number}\insertframenumber~\frameofframes~\inserttotalframenumber}
    \end{beamercolorbox}
    \begin{beamercolorbox}[colsep=1.5pt]
        {lower separation line foot}
    \end{beamercolorbox}
}
\makeatother

\useinnertheme{circles}

%\useoutertheme{default}
%\useinnertheme[shadow=true]{rounded}

\xdefinecolor{CAU}{RGB}{          0, 135,  60}
\xdefinecolor{CAU_GREEN}{RGB}{    0, 135,  60}
\xdefinecolor{CAU_YELLOW}{RGB}{ 167, 130,  39}
\xdefinecolor{CAU_CAST}{RGB}{   211, 117,  64} %动科
\xdefinecolor{CAU_CAB}{RGB}{     41, 142,  26} %农学
\xdefinecolor{CAU_CH}{RGB}{       0, 135,  60} %园艺
\xdefinecolor{CAU_YYXY}{RGB}{     0, 135,  60} %园艺
\xdefinecolor{CAU_CPP}{RGB}{     24, 134,  12} %植保
\xdefinecolor{CAU_CBS}{RGB}{     35, 106, 202} %生院
\xdefinecolor{CAU_CRES}{RGB}{     0, 109,   0} %资环
\xdefinecolor{CAU_ZIHUAN}{RGB}{   0, 109,   0} %资环
\xdefinecolor{CAU_CVM}{RGB}{     20,  89, 129} %动医
\xdefinecolor{CAU_CFSNE}{RGB}{    0,  70,  25} %食品
\xdefinecolor{CAU_SPXY}{RGB}{     0,  70,  25} %食品
\xdefinecolor{CAU_COE}{RGB}{     34,  83, 162} %工院
\xdefinecolor{CAU_CIEE}{RGB}{     0, 153, 102} %信电
\xdefinecolor{CAU_WATER}{RGB}{   35, 142, 210} %水院
\xdefinecolor{CAU_SCI}{RGB}{     45,  72, 130} %理院
\xdefinecolor{CAU_CEM}{RGB}{    100,  30, 118} %经管
\xdefinecolor{CAU_COHD}{RGB}{   153,   0,   0} %人发
\xdefinecolor{CAU_CM}{RGB}{     232,   0,   1} %马院
\xdefinecolor{CAU_ICB}{RGB}{    215,  10,  48} %国院
\xdefinecolor{CAU_CLST}{RGB}{    15, 132,   0} %土院
\xdefinecolor{CAU_CGST}{RGB}{     0, 142,  60} %草业

\DeclareOptionX{color}{\edef\mycolor{#1}}
\ProcessOptionsX

\ifdefined\mycolor
    \colorlet{use_color}{\mycolor}
\else
    \colorlet{use_color}{CAU}
\fi

\setbeamercolor{footline}{bg=use_color}
\setbeamercolor{frametitle}{bg=use_color,fg=white}
\setbeamercolor{title}{bg=use_color}
\setbeamerfont{frametitle}{size=\large}
%\setbeamertemplate{navigation symbols}{}
\setbeamertemplate{bibliography item}[text]
\setbeamertemplate{caption}[numbered]

\setbeamercolor{palette primary}{use=structure,fg=white,bg=structure.fg}
\setbeamercolor{palette secondary}{use=structure,fg=white,bg=structure.fg!75!black}
\setbeamercolor{palette tertiary}{use=structure,fg=white,bg=structure.fg!50!black}
\setbeamercolor{palette quaternary}{fg=white,bg=structure.fg!50!black}
%\setbeamercolor*{sidebar}{use=structure,bg=structure.fg}
\setbeamercolor{titlelike}{parent=palette primary}

%% try
\setbeamercolor{block title}{bg=use_color,fg=white}
\setbeamercolor*{block title example}{use={normal text,example text},bg=white,fg=use_color}
\setbeamercolor{fine separation line}{}
\setbeamercolor{item projected}{fg=white}
\setbeamercolor{palette sidebar primary}{use=normal text,fg=normal text.fg}
\setbeamercolor{palette sidebar quaternary}{use=structure,fg=structure.fg}
\setbeamercolor{palette sidebar secondary}{use=structure,fg=structure.fg}
\setbeamercolor{palette sidebar tertiary}{use=normal text,fg=normal text.fg}
%\setbeamercolor{palette sidebar quaternary}{fg=white}
\setbeamercolor{section in sidebar}{fg=brown}
\setbeamercolor{section in sidebar shaded}{fg=grey}
\setbeamercolor{separation line}{}
\setbeamercolor{sidebar}{bg=use_color}
\setbeamercolor{sidebar}{parent=palette primary}
\setbeamercolor{structure}{fg=use_color}
\setbeamercolor{subsection in sidebar}{fg=brown}
\setbeamercolor{subsection in sidebar shaded}{fg=grey}

\usepackage{etoolbox} % 导入 etoolbox 包

\AtBeginSection[]{
    \begin{frame}
        \tableofcontents[
            sectionstyle=show/shaded,
            subsectionstyle=show/shaded/hide,
            subsubsectionstyle=show/shaded/hide
        ]
    \end{frame}
}
\AtBeginSubsection[]{
    \begin{frame}
        \tableofcontents[
            sectionstyle=show/shaded,
            subsectionstyle=show/shaded/hide,
            subsubsectionstyle=show/shaded/hide]
    \end{frame}
}

\mode
<all>
